<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>序列帧图片</title>
    <style>
        .container{
            width:1000px;
            height:600px;
            margin:0 auto;
        }
    </style>
</head>
<body>
    <div class="container" id = "container"> 
        <canvas id = "canvas" style="border:1px solid rgb(112, 112, 112)"></canvas>
    </div>
</body>
<script>
    let starArr = [];
    let context = null;
    let interval = null;
    let canvas = null;
    let drawStarOrNot = false;
    let starOpacity = 0;
    let canvasLeft = 0;
    let canvasTop = 0;
    window.onload =  function(){
        canvas = document.getElementById('canvas');
        context = canvas.getContext('2d');
        canvas.width = 1000;
        canvas.height = 600;

        canvasLeft = canvas.offsetLeft;
        canvasTop = canvas.offsetTop;


        for(let i = 0; i<100; i++){
            let obj = initStrat();
            starArr.push(obj)
        }

        interval = setInterval(()=>{
            initPic(); 
        },50)  

        document.body.addEventListener('mousemove', mousemove, true) 
        
    }

    function initPic(){
        let img = new Image();
        img.src = "pic/girl.jpg";
        img.onload = function(){
            context.clearRect(0,0,canvas.width,canvas.height);
            context.fillStyle = 'rgb(112, 112, 112)';
            context.fillRect(0,0,canvas.width,canvas.height);
            context.drawImage(img,0,0,img.width,img.height,20,20,canvas.width-40,canvas.height-40)
          
            if(drawStarOrNot){
                if(starOpacity<1){
                    starOpacity = starOpacity+0.1
                }
                else{
                    starOpacity = 1
                }
               
            }
            else{
                if(starOpacity>0){
                    starOpacity = starOpacity-0.1
                }
                else{
                    starOpacity = 0
                }
            }

            if(starOpacity >0.01 ){
               drawStart() 
            }         
            
        }

    }
    
    function initStrat(){   
        let x = (canvas.width-40)*Math.random()+20;
        let y = (canvas.height-40)*Math.random()+20;
        let picNo = Math.floor(Math.random()*7);
        let vy = (Math.random())*Math.pow( -1, Math.ceil(Math.random()*1000) )
        return {x:x,y:y,picNo:picNo,vy:vy};        
    }

    function drawStart(){
        
        let starImg = new Image();
        starImg.src = "pic/star.png"
        starImg.onload = function(){
            context.save();
            context.globalAlpha = starOpacity
            for(let i = 0; i<starArr.length; i++){  
           
                starArr[i].y = starArr[i].y+starArr[i].vy;
                starArr[i].picNo = starArr[i].picNo+1>7?0:starArr[i].picNo+1;  

                if(starArr[i].y < 20 ||starArr[i].y>canvas.height-20){
                   let obj = initStrat();
                   starArr[i] = obj;
                }  
                else{
                    context.drawImage(starImg,starArr[i].picNo*7,0,7,7,starArr[i].x,starArr[i].y,7,7)
                }
            }
            context.restore();
        }
        
        
    }

    function mousemove(event){
        var e = event || window.event;
        var scrollX = document.documentElement.scrollLeft || document.body.scrollLeft;
        var scrollY = document.documentElement.scrollTop || document.body.scrollTop;
        var left = (e.pageX || e.clientX + scrollX)-canvasLeft;
        var top = (e.pageY || e.clientY + scrollY)-canvasTop;
    
        
        if(left>=20 && left<canvas.width-20 && top>20 &&top<canvas.height-20){
            drawStarOrNot = true
        }
        else{
            drawStarOrNot = false
        }
    }
</script>
</html>